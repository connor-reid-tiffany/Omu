pie_chart <- function(data, type, subplot){
  
  colnames(data)[1] <- "Pathway"  
  if(subplot==TRUE){
    Dec = "Decrease"
    Inc = "Increase"
    
    data_dec = data[data$colour %in% Dec,]
    data_dec$Significant_Changes = abs(data_dec$Significant_Changes)
    data_dec = data_dec[,c(1,2)]
    data_dec$Significant_Changes = prop.table(data_dec$Significant_Changes)
    data_dec$Significant_Changes = data_dec$Significant_Changes * 100
    
    data_inc = data[data$colour %in% Inc,]
    data_inc = data_inc[,c(1,2)]
    data_inc$Significant_Changes = prop.table(data_inc$Significant_Changes)
    data_inc$Significant_Changes = data_inc$Significant_Changes * 100
    
    data$Significant_Changes = abs(data$Significant_Changes)
    data = data[,c(1,2)]
    data = ddply(data, "Pathway", numcolwise(sum)) 
    data$Significant_Changes = prop.table(data$Significant_Changes)
    data$Significant_Changes = data$Significant_Changes * 100
    
    pie <- plot_ly() %>%
      add_pie(data = data_dec, labels = ~Pathway, values = ~Significant_Changes,
              name = "Decrease",domain = list(x = c(0, 0.4), y = c(0.4, 1)), 
              textposition = 'inside', textinfo = 'percent', 
              insidetextfont = list(color = '#FFFFFF', size = 14)) %>%
      
      
      add_pie(data = data_inc, labels = ~Pathway, values = ~Significant_Changes,
              name = "Increase", domain = list(x = c(0.6, 1), y = c(0.4, 1)), 
              textposition = 'inside', textinfo = 'percent', 
              insidetextfont = list(color = '#FFFFFF', size = 14)) %>%
      
      add_pie(data = data, labels = ~Pathway, values = ~Significant_Changes,
              name = "All", domain = list(x = c(0.25, 0.75), y = c(0, 0.6)), 
              textposition = 'inside', textinfo = 'percent', 
              insidetextfont = list(color = '#FFFFFF', size = 14)) %>%
      
      layout(title = "Abundance", showlegend = F,
             xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
             yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE)) 
    return(pie)
    
  }else{if(subplot==FALSE){
    
    if(!missing(type)){
      Subset = type
      data = data[data$colour %in% Subset,]
    }else{data = data}
    
    data$Significant_Changes = abs(data$Significant_Changes)
    data = data[,c(1,2)]
    data = ddply(data, "Pathway", numcolwise(sum)) 
    data$Significant_Changes = prop.table(data$Significant_Changes)
    data$Significant_Changes = data$Significant_Changes * 100
    pie <- plot_ly(data = data, labels = data[,1], values = ~Significant_Changes, type = 'pie',textposition = 'inside', textinfo = 'percent', 
                   insidetextfont = list(color = '#FFFFFF', size = 14))
    return(pie)
    
    }
  }
}
